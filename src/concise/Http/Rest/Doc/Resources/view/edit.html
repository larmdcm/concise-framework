<div id="app">
	<div class="row">
		<div class="col-sm-10">
			<form class="form-horizontal">
				<div class="form-group">
					 <label class="col-sm-2 control-label">接口:</label>
					 <div class="col-sm-10">
						<iter-list type="add"></iter-list>
				     </div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">名称:</label>
					<div class="col-sm-10">
						<input type="text" name="name" class="form-control" v-model="name"/>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">URL:</label>
					<div class="col-sm-10">
						<input type="text" name="url" class="form-control" v-model="url"/>
					</div>
				</div>
				<div class="form-group">
					 <label class="col-sm-2 control-label">方法:</label>
					 <div class="col-sm-10">
						 <select v-model="method" name="iterface" class="form-control" >
							 <option value="POST">POST</option>
							 <option value="GET">GET</option>
						 </select>
				    </div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">备注:</label>
					<div class="col-sm-10">
						<textarea name="remark" class="form-control" cols="30" rows="5" v-model="remark">{{ remark }}</textarea>
					</div>
				</div>
			</form>
		</div>
	</div>
	<div class="row" id="postparam">
		<table-create :thead="tableCreateParams.thead" :tbody="tableCreateParams.tbody" type="params"></table-create>
	</div>
	<div class="row" id="returnparam">
		<table-create :thead="tableReturnParams.thead" :tbody="tableReturnParams.tbody" type="return"></table-create>
	</div>
	<div class="row">
		<div class="col-sm-11">
			<form>
				<div class="form-group">
					<input class="btn btn-default" type="button" value="提交保存" @click="create">
				</div>
			</form>
		</div>
	</div>
</div>

<script type="text/javascript">
	 window.app = new Vue({
		el: '#app',
		data: {
			name: "",
			url: "",
			method: "",
			remark: "",
			selectedUrl: "",
			tableCreateParams: {
				thead: ["参数","类型","必须","说明","测试值","操作"],
				tbody: []
			},
			tableReturnParams: {
				thead: ["参数","类型","说明","操作"],
				tbody: []
			}
		},
		methods: {
			create: function () {
				var vm = this
				  , postparam   = getParams('#postparam')
				  , returnparam = getParams('#returnparam')
				  , sendParams  = [];
				  sendParams = {
				  	 name: vm.name,
				  	 selectedUrl: vm.selectedUrl,
				  	 url: vm.url,
				  	 method: vm.method,
				  	 remark: vm.remark,
				  	 postparam: postparam,
				  	 returnparam: returnparam
				  };
				 Vue.$http.post(getRequstUrl("save"),{data: sendParams},function (response) {
				 	  if (response.errorcode == getStatus('success')) {
				 	  	  dialog.success(response.errormsg,apiConfig['name'],function () {
				 	  	  		var keyName = response.data.keyName ? response.data.keyName : '';
				 	  	  		app.$emit("changeIterUrl",vm.selectedUrl,sendParams,keyName);
				 	  	  });
				 	  } else {
				 	  	  dialog.error(response.errormsg,apiConfig['name']);
				 	  }
				 });
			},
			reset: function () {
				var vm = this;
				mce.struct.each(['name','url','method','remark'],function (k,v) {
					mce.toolFn.isObject(vm[v]) ? vm[v] = {} : v == 'method' ? vm[v] = 'POST' : vm[v] = '';
				});
				vm.tableCreateParams.tbody = apiConfig.postParmas;
				vm.tableReturnParams.tbody = apiConfig.returnParams;
			},
			setData: function (data) {
				var vm = this;
				mce.struct.each(data,function (k,v) {
					vm[k] = v;
				});
			}
		},
		components: {
			"table-create": components.tableCreate,
			"iter-list": components.interfaceSelectList
		},
		mounted: function () {
			var vm = this;
			vm.$on('changeUrl',function (url) {
				vm.selectedUrl = url;
				var key = "iterList." + url
				  , callback = function (response) {
					cache.set(key,response);
					vm.tableCreateParams.tbody = response.data.postparam ? response.data.postparam : apiConfig.postParmas;
					vm.tableReturnParams.tbody = response.data.returnparam ? response.data.returnparam : apiConfig.returnParams;

					vm.setData({
						name: response.data.name,
						url: response.data.url,
						method: response.data.method,
						remark: response.data.remark,
					});
				};
				if (url == 'add') {
					return vm.reset();
				}
				cache.has(key) ? callback(cache.read(key)) : Vue.$http.post(getRequstUrl('get'),{url: url},callback);
			});
			mce.struct.each(['#interfaceSelect'],function (index,item) {
				$(item).selectpicker();
			});
		}
	});
</script>